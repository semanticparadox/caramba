<header class="modal-header">
    <h3 class="text-xl font-bold text-white flex items-center gap-3">
        <i data-lucide="terminal" class="w-6 h-6 text-indigo-400"></i>
        Manual Setup: <span class="text-indigo-400 font-mono text-base">{{ node.name }}</span>
    </h3>
    <button onclick="document.getElementById('manual-install-modal').close()"
        class="text-slate-400 hover:text-white transition-colors p-2 hover:bg-white/5 rounded-lg">
        <i data-lucide="x" class="w-5 h-5"></i>
    </button>
</header>

<div class="modal-body space-y-8">
    <!-- One Liner -->
    <div class="space-y-3">
        <label class="block text-xs font-bold text-slate-500 uppercase tracking-widest">Quick Installation
            Command</label>
        <div class="relative group">
            <div class="absolute inset-0 bg-emerald-500/5 rounded-2xl pointer-events-none"></div>
            <input type="text" id="one-liner" value="Calculating..." readonly
                class="w-full bg-[#0a0a0a] border border-emerald-500/20 rounded-2xl px-5 py-4 pr-28 text-emerald-400 font-mono text-xs focus:border-emerald-500 outline-none leading-relaxed transition-all">

            <button onclick="copyToClipboard('one-liner')"
                class="absolute right-3 top-3 bottom-3 px-4 bg-emerald-500/10 hover:bg-emerald-500/20 text-emerald-400 text-[10px] font-bold uppercase tracking-wider rounded-xl transition-all border border-emerald-500/20 flex items-center gap-2 active:scale-95">
                <i data-lucide="copy" class="w-3.5 h-3.5"></i> Copy
            </button>
        </div>
        <div class="p-4 rounded-2xl bg-amber-500/5 border border-amber-500/10 space-y-3">
            <div class="flex gap-3">
                <i data-lucide="info" class="w-4 h-4 text-amber-500 flex-shrink-0 mt-0.5"></i>
                <p class="text-[11px] font-bold text-amber-500 uppercase tracking-widest">Requirements & Troubleshooting
                </p>
            </div>
            <ul class="text-[11px] text-slate-500 space-y-1.5 list-disc list-inside px-1">
                <li>Debian 12+ or Ubuntu 22.04+ (Clean OS recommended)</li>
                <li>Ensure ports 80 and 443 are open in your VPS firewall</li>
                <li>Command must be run as <span class="text-slate-400 font-bold">root</span> or via <span
                        class="text-slate-400 font-bold">sudo</span></li>
                <li>If installation fails, run: <code
                        class="bg-white/5 px-1 rounded text-slate-400">journalctl -u exarobot-agent -f</code></li>
            </ul>
        </div>
    </div>
</div>

<footer class="modal-footer">
    <button class="btn-secondary" onclick="document.getElementById('manual-install-modal').close()">Close
        Window</button>
</footer>

<script>
    (function () {
        const origin = window.location.origin;
        const token = "{{ node.join_token.clone().unwrap_or_default() }}";
        const cmd = `curl -sSL https://raw.githubusercontent.com/semanticparadox/EXA-ROBOT/main/scripts/install.sh | sudo bash -s -- --role agent --panel "${origin}" --token "${token}"`;
        document.getElementById('one-liner').value = cmd;
    })();

    function copyToClipboard(elementId) {
        const el = document.getElementById(elementId);
        const originalValue = el.value;

        navigator.clipboard.writeText(originalValue).then(() => {
            const btn = el.parentElement.querySelector('button');
            const originalContent = btn.innerHTML;

            btn.innerHTML = '<i data-lucide="check" class="w-3.5 h-3.5"></i> Copied!';
            btn.classList.replace('text-emerald-400', 'text-white');
            btn.classList.replace('bg-emerald-500/10', 'bg-emerald-500');

            setTimeout(() => {
                btn.innerHTML = originalContent;
                btn.classList.replace('text-white', 'text-emerald-400');
                btn.classList.replace('bg-emerald-500', 'bg-emerald-500/10');
                lucide.createIcons();
            }, 2000);
            lucide.createIcons();
            showToast("Installation command copied");
        });
    }

    lucide.createIcons();
</script>