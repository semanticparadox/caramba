<!DOCTYPE html>
<html lang="en" data-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EXA ROBOT - {% block title %}{% endblock %}</title>
    <!-- CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
    <link rel="stylesheet" href="{{ admin_path }}/assets/css/modern.css">

    <!-- Scripts -->
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
    {% if is_auth %}
    <div class="app-layout">
        <!-- Vertical Sidebar -->
        <aside class="sidebar">
            <div class="brand">
                <i data-lucide="zap" style="color:#6366f1; fill: #6366f1;"></i>
                <span>EXA ROBOT</span>
            </div>

            <ul class="nav-links">
                <li class="nav-item">
                    <a href="{{ admin_path }}/dashboard" {% if active_page=="dashboard" %}class="active" {% endif %}>
                        <i data-lucide="layout-dashboard"></i> Dashboard
                    </a>
                </li>
                <li class="nav-item">
                    <a href="{{ admin_path }}/nodes" {% if active_page=="nodes" %}class="active" {% endif %}>
                        <i data-lucide="server"></i> Nodes
                    </a>
                </li>
                <li class="nav-item">
                    <a href="{{ admin_path }}/plans" {% if active_page=="plans" %}class="active" {% endif %}>
                        <i data-lucide="box"></i> Plans
                    </a>
                </li>
                <li class="nav-item">
                    <a href="{{ admin_path }}/users" {% if active_page=="users" %}class="active" {% endif %}>
                        <i data-lucide="users"></i> Users
                    </a>
                </li>
                <li class="nav-item">
                    <a href="{{ admin_path }}/store/orders" {% if active_page=="orders" %}class="active" {% endif %}>
                        <i data-lucide="shopping-cart"></i> Store & Orders
                    </a>
                </li>
                <li class="nav-item">
                    <a href="{{ admin_path }}/transactions" {% if active_page=="transactions" %}class="active" {% endif
                        %}>
                        <i data-lucide="receipt"></i> Transactions
                    </a>
                </li>
                <li class="nav-item">
                    <a href="{{ admin_path }}/settings" {% if active_page=="settings" %}class="active" {% endif %}>
                        <i data-lucide="settings"></i> Settings
                    </a>
                </li>
            </ul>

            <div class="nav-footer">
                <form hx-post="{{ admin_path }}/logout" hx-trigger="click" style="margin:0;">
                    <a href="#" class="nav-item-link"
                        style="display:flex; gap:1rem; color: #ff5555; text-decoration:none;">
                        <i data-lucide="log-out"></i> Logout
                    </a>
                </form>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="main-content">
            <!-- Top Header (Breadcrumbs / Wallet) -->
            <header class="top-bar">
                <h1 class="page-title">{% block header_title %}Dashboard{% endblock %}</h1>
                <div class="user-profile">
                    <!-- Placeholder for user / wallet info if needed -->
                </div>
            </header>

            {% block content %}{% endblock %}
        </main>
    </div>
    {% else %}
    <!-- Public Layout (Login) -->
    <main class="container" style="display:flex; align-items:center; justify-content:center; min-height:100vh;">
        {% block content %}{% endblock %}
    </main>
    {% endif %}

    <div id="toast" class="toast"></div>

    <script>
        // Init Icons
        lucide.createIcons();

        document.body.addEventListener('htmx:afterOnLoad', function (evt) {
            lucide.createIcons(); // Re-init icons after swaps
            if (evt.detail.xhr.status === 200 && (evt.detail.elt.id === "settings-form" || evt.detail.elt.hasAttribute("hx-post"))) {
                showToast("Action completed successfully!");
            }
        });

        function showToast(message) {
            const toast = document.getElementById('toast');
            if (toast) {
                toast.innerText = message;
                toast.style.display = 'block';
                setTimeout(() => { toast.style.display = 'none'; }, 3000);
            }
        }
    </script>
</body>

</html>